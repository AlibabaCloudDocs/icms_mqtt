# 产品系列和定价 {#concept_52819_zh .concept}

本文对微消息队列 MQTT 的实例类型和计费规格信息进行说明，具体售卖价格以及活动信息请以[购买页](https://common-buy.aliyun.com/?spm=a2c4g.11186623.2.23.7a0852detgpXCl&commodityCode=onsMqtt#/buy)为准。

 ![](images/43248_zh-CN.png "产品系列说明")

## 实例类型 {#section_r5m_2iu_5h6 .section}

微消息队列 MQTT 的实例类型和相关说明如[表 1](#table_ewj_cg4_hhb)所示。

|实例类型|实例模型|计费模型|适用场景|
|----|----|----|----|
|按量付费实例|按量付费实例是微消息队列提供的共享型服务，即底层硬件资源是共享的，多个实例共享同一个后端集群，由 MQTT 来保证多租户场景下的服务可用性。|计费方式按照客户实际使用量进行后付费。|后付费版实例计费是按照实际用量来计算，因此适用于业务规模变化和波动比较大的场景。|
|基础版实例|基础版实例是微消息队列提供的共享型服务，即底层硬件资源是共享的，多个实例共享同一个后端集群，由 MQTT 来保证多租户场景下的服务可用性。|按照用户购买规格，以包年或者包月的形式进行预付费。|标准版实例适用于业务规模较小的客户，标准版提供的规格较低，价格也低。|
|铂金版实例|铂金版实例是微消息队列提供的专享型服务，即底层硬件资源是独享的，每个铂金版实例都是独立部署的集群，不会受到其他用户的业务高峰的影响，提供更高优先级的售后服务和稳定性保障。|按照用户购买规格，以包年或者包月的形式进行预付费。|企业铂金版实例适用于业务规模庞大，有定制需求的客户，提供的规格都比较大，价格成本也更高。|

## 预付费计费说明 {#section_60k_mlj_57k .section}

**1. 消息收发 TPS（预付费）**

**定义**

消息收发 TPS 指每秒钟使用微消息队列支持的协议，比如 MQTT、808、新能源汽车国标等协议进行上行数据发送和下行数据接收的消息总条数。

**计费说明**

-   消息 TPS 指的是直接通过微消息队列 MQTT 进行收发的消息，不包含直接使用消息队列 MQ 相关接口进行收发的消息；
-   消息 TPS 包括消息接收的 TPS 和消息发送的 TPS；
-   对于 QoS=1 且 cleanSession=false 的消息，如果没有推送成功会存储到离线消息等待重试，存储离线消息也会计算成一次推送调用；
-   消息收发 TPS 为基本计价单位，针对具体协议中的特定传输质量，需要乘以相应的倍率。具体参考如下表所示。

|传输质量级别|计价倍率|
|------|----|
|无|1|
|MQTT 协议 QoS=0 且 cleanSession=true|1|
|MQTT 协议 QoS=0 且 cleanSession=false|1|
|MQTT 协议 QoS=1 且 cleanSession=true|2|
|MQTT 协议 QoS=1 且 cleanSession=false|5|
|MQTT 协议 QoS=2（只支持 cleanSession=true）|5|

**示例**

假设 \[instance\_a\] 有 100 个客户端，每个客户端都设置了 cleanSession=true； 每秒发送：1 条 QoS0 消息，2 条 QoS1 消息，3 条 QoS2 消息； 每秒接收：1 条 QoS0 消息，1 条 QoS1 消息，1 条 QoS2 消息；\[instance\_a\] 的消息 TPS 为：

100 x \(1 + 2 x 2 + 3 x 5\) + 100 x \(1 + 1 x 2 + 1 x 5\) = 2800

**2. 同时在线连接数**

**定义**

同时在线连接数指任一时刻在单个实例上存在的客户端 TCP 连接的数量；最大连接数即用户同时在线连接数的峰值，不同于日活，月活等概念。同时在线连接数是瞬态值，更新周期为 1 分钟。

**说明：** 

温馨提示：实际购买微消息队列实例时需要选择合理的连接数规格，以免业务出现连接峰值脉冲时触发服务的限流导致部分客户端无法连接。

**示例**

假设 \[instance\_a\] 10:00 的同时在线数是 1000，10:01 的同时在线数是 2000，那么， \[instance\_a\] 需要购买超过 2000 的规格才能保证服务正常运行。

**3. 订阅关系数**

**定义**

订阅关系数指用户在微消息队列服务端注册保留的订阅规则的数量。

**计费说明**

-   订阅关系的计算单位是每个 ClientId 对每个 MQTT Topic 的订阅；
-   订阅关系数的统计周期为 5 分钟，服务端统计会给出统计周期内的最大值；
-   根据 MQTT 协议，当客户端设置 cleansession=true 时，客户端离线后服务端会清理掉该客户端所有订阅的 Topic；如果 cleanSession=false，服务端会一直保留客户端订阅的 Topic。

**示例**

假设 \[instance\_a\] 有 2 个设备：client\_1 和 client\_2，其中 client\_1 订阅了 TopicA/sub\_1、TopicA/sub\_2、TopicB；client\_2 订阅了 TopicA/sub\_1、TopicB/sub\_2； 则 \[instance\_a\] 的订阅关系数是：3 + 2 = 5。

## 按量付费实例计费说明 {#section_gzs_fqr_5qz .section}

**1. 消息收发量**

**定义**

消息收发量指计费周期内使用微消息队列 MQTT 支持的协议，比如 MQTT、808、新能源汽车国标等协议进行上行数据发送和下行数据接收的消息总条数。

**计费说明**

-   计费周期为 1 天，即每天账单中统计的是前一天 0 点开始的 24 小时内的消息条数；
-   消息收发量是直接通过微消息队列 MQTT 进行收发的消息，不包含直接使用消息队列 MQ 相关接口进行收发的消息；
-   对于 QoS=1 且 cleanSession=false 的消息，如果没有推送成功会存储到离线消息等待重试，存储离线消息也会计算成一次推送调用；
-   消息收发量以 1 为基本计价单位，针对具体协议中的特定传输质量，需要乘以相应的倍率，具体参考如下表所示。

|传输质量级别|计价倍率|
|------|----|
|无|1|
|MQTT 协议 QoS=0 且 cleanSession=true|1|
|MQTT 协议 QoS=0 且 cleanSession=false|1|
|MQTT 协议 QoS=1 且 cleanSession=true|2|
|MQTT 协议 QoS=1 且 cleanSession=false|5|
|MQTT 协议 QoS=2（只支持 cleanSession=true）|5|

**示例**

假设 \[instance\_a\] 有 100 个客户端，每个客户端都设置了 cleanSession=true； 消息发送：1 条 QoS0 消息，2 条 QoS1 消息，3 条 QoS2 消息； 消息接收：1 条 QoS0 消息，1 条 QoS1 消息，1 条 QoS2 消息； \[instance\_a\] 的消息收发量 为：

100 x \(1 + 2 x 2 + 3 x 5\) + 100 x \(1 + 1 x 2 + 1 x 5\) = 2800

**2. 同时在线连接数**

**定义**

同时在线连接数指任一时刻在单个实例上存在的客户端 TCP 连接的数量。

**说明：** 

-   计费周期为 1 天，即每天账单中统计的是前一天 0 点开始的 24 小时内同时在线链接数的最大值；
-   后付费实例统计同时在线连接数，取计费周期内的最大值，类似日活的概念。

**示例**

假设 \[instance\_a\] 2017-08-08 10:00 的同时在线数是 1000，2017-08-08 11:00 的同时在线数是 2000，后续时刻即便都没有达到过 2000，2017-08-08 当天 \[instance\_a\] 在线连接数最大值为 2000，则计费值为 2000。

**3. 订阅关系数**

**定义**

订阅关系数指用户在微消息队列服务端注册保留的订阅规则的数量。

**说明：** 

-   计费周期为 1 天，即每天账单中统计的是前一天 0 点开始的 24 小时内订阅关系数的最大值；
-   后付费实例统计订阅关系数，取计费周期内的最大值，类似日活的概念。

**示例**

假设 \[instance\_a\] 2017-08-08 10:00 的订阅关系数是 1000，2017-08-08 11:00 时删除了 500 个，且后续时刻都没有达到过 1000，2017-08-08 当天 \[instance\_a\] 订阅关系数最大值为 1000，则计费值为 1000。

